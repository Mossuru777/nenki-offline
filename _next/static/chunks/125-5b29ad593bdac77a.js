"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[125],{8125:function(e,t,a){a.r(t),a.d(t,{default:function(){return A}});var n,i,r,s,l=a(5893),d=a(7294),o=a(381),u=a.n(o),h=a(1926),c=a(1614),_=a(5084),m=a(523),y=a(1890),x=a(6779),b=a(5398),v=a(7745),f=a(2097),Z=a(1225),D=a(1953),p=a(2841),j=a(1362),P=a(4642),g=a(6540),k=a(55),w=a(8047),Y=a(1733),C=a(4099);function A(e){var t,a;let o=e=>{var t;let a=e?{name:e.name,title:e.title,deathDate:u()(e.death_date).format("YYYY-MM-DD"),birthDate:e.birth_date?u()(e.birth_date).format("YYYY-MM-DD"):"",isBirthDateAccurate:null!==(t=e.is_birth_date_accurate)&&void 0!==t&&t}:{name:"",title:"",deathDate:"",birthDate:"",isBirthDateAccurate:!1};return{currentPerson:e,isNameValid:!0,isDeathDateValid:!0,isBirthDateValid:!0,...a}},[{currentPerson:A,name:V,isNameValid:B,title:M,deathDate:O,isDeathDateValid:S,birthDate:T,isBirthDateValid:z,isBirthDateAccurate:I},N]=d.useState(()=>o(null)),[F,E]=d.useState(!1),L=async()=>{let e=V.length>0,t=O.length>0,a=0===O.length||0===T.length||new Date(T)<=new Date(O);return(N(n=>({...n,isNameValid:e,isDeathDateValid:t,isBirthDateValid:a})),e&&t&&a)?Promise.resolve():Promise.reject({isNameValid:e,isDeathDateValid:t,isBirthDateValid:a})},G=e=>{let{name:t,value:a}=e.target,l={isNameValid:B,isDeathDateValid:S,isBirthDateValid:z,isBirthDateAccurate:I};"name"===t?(n=l).isNameValid||(n.isNameValid=a.length>0):"deathDate"===t?a.length>0?(i=l).isDeathDateValid||(i.isDeathDateValid=!0):(r=l).isBirthDateValid||(r.isBirthDateValid=!0):"birthDate"===t&&((s=l).isBirthDateValid||(s.isBirthDateValid=0===a.length||new Date(a)<=new Date(O))),N(e=>({...e,[t]:a,...l}))},K=e=>{let t=e.target.name,a=e.target.checked;N(e=>({...e,[t]:a}))},q=async()=>{if(!B||!S||!z)return Promise.reject({isNameValid:B,isDeathDateValid:S,isBirthDateValid:z});{let t=u().tz(O,"YYYY-MM-DD",!0,"Asia/Tokyo"),a=""!==T?u().tz(T,"YYYY-MM-DD",!0,"Asia/Tokyo"):null,n=null!==a?I:null;if(e.editPerson)return e.editPerson.name=V,e.editPerson.title=M,e.editPerson.death_date=t,e.editPerson.birth_date=a,e.editPerson.is_birth_date_accurate=n,c.Z.instance.updatePerson(e.editPerson);{let i=new h.Z(null,V,M,t,a,n);return c.Z.instance.addPerson(i)}}},H=()=>{L().then(()=>E(!0)).then(q).then(e.closeDialog).catch(e=>{}).finally(()=>E(!1))},J=()=>{e.editPerson&&X(!0)},Q=()=>{X(!1),e.editPerson&&(E(!0),c.Z.instance.deletePerson(e.editPerson).then(e.closeDialog).catch(e=>{}).finally(()=>E(!1)))},R=(0,f.Z)(),U=(0,Z.Z)(R.breakpoints.down("sm")),[W,X]=d.useState(!1);return A!==e.editPerson&&N(()=>o(e.editPerson)),(0,l.jsxs)(D.Z,{children:[(0,l.jsxs)(y.Z,{fullScreen:U,open:void 0!==A,children:[(0,l.jsx)(v.Z,{children:"人物の追加"}),(0,l.jsxs)(b.Z,{sx:{"& .MuiTextField-root":{m:2}},children:[(0,l.jsxs)(D.Z,{sx:{display:"flex"},children:[(0,l.jsx)(m.Z,{autoFocus:!0,label:"名前",name:"name",value:V,error:!B,helperText:B?null:"名前を入力して下さい",onChange:G,variant:"standard",inputProps:{size:30}}),(0,l.jsx)(m.Z,{label:"敬称",name:"title",value:M,onChange:G,variant:"standard",inputProps:{size:8}})]}),(0,l.jsx)(D.Z,{children:(0,l.jsx)(m.Z,{label:"命日",type:"date",name:"deathDate",value:O,error:!S,helperText:S?null:"命日を入力して下さい",onChange:G,variant:"standard",sx:{width:220},InputLabelProps:{shrink:!0}})}),(0,l.jsxs)(D.Z,{sx:{display:"flex"},children:[(0,l.jsx)(m.Z,{label:"生年月日",type:"date",name:"birthDate",value:T,error:!z,helperText:z?null:"命日より前の日付を入力して下さい",onChange:G,variant:"standard",sx:{width:220},InputLabelProps:{shrink:!0}}),(0,l.jsx)(p.Z,{control:(0,l.jsx)(j.Z,{name:"isBirthDateAccurate",checked:I,onChange:K,color:"primary"}),label:"生年月日は正確です"})]})]}),(0,l.jsxs)(x.Z,{children:[e.editPerson?(0,l.jsx)(C.Z,{color:"error",disabled:F,onClick:J,children:(0,l.jsx)(Y.Z,{})}):null,(0,l.jsx)("div",{style:{flexGrow:1}}),(0,l.jsx)(_.Z,{variant:"outlined",color:"error",disabled:F,startIcon:(0,l.jsx)(w.Z,{}),onClick:e.closeDialog,children:"キャンセル"}),e.editPerson?(0,l.jsx)(C.Z,{variant:"contained",loading:F,disabled:F,startIcon:(0,l.jsx)(k.Z,{}),onClick:H,children:"更新"}):(0,l.jsx)(C.Z,{variant:"contained",loading:F,disabled:F,startIcon:(0,l.jsx)(g.Z,{}),onClick:H,children:"追加"})]})]}),(0,l.jsxs)(y.Z,{open:W,children:[(0,l.jsx)(v.Z,{children:"確認"}),(0,l.jsx)(b.Z,{children:(0,l.jsxs)(P.Z,{children:[null===(t=e.editPerson)||void 0===t?void 0:t.name,null===(a=e.editPerson)||void 0===a?void 0:a.title," のデータを削除しますが、よろしいですか?"]})}),(0,l.jsxs)(x.Z,{children:[(0,l.jsx)(_.Z,{onClick:()=>X(!1),children:"キャンセル"}),(0,l.jsx)(_.Z,{color:"error",onClick:Q,autoFocus:!0,children:"OK"})]})]})]})}},1614:function(e,t,a){a.d(t,{Z:function(){return l}});var n=a(9520),i=a(8),r=a.n(i),s=a(1926);class l extends n.default{async addPerson(e){var t,a;let n={name:e.name,title:e.title,death_date_unixtime:e.death_date.valueOf(),birth_date_unixtime:null!==(a=null===(t=e.birth_date)||void 0===t?void 0:t.valueOf())&&void 0!==a?a:null,is_birth_date_accurate:e.is_birth_date_accurate};return this.persons.add(n)}async updatePerson(e){var t,a;return this.persons.update(e.db_id,{name:e.name,title:e.title,death_date_unixtime:e.death_date.valueOf(),birth_date_unixtime:null!==(a=null===(t=e.birth_date)||void 0===t?void 0:t.valueOf())&&void 0!==a?a:null,is_birth_date_accurate:e.is_birth_date_accurate})}async deletePerson(e){return null===e.db_id?Promise.reject("Person has no db_id."):this.persons.delete(e.db_id)}async getAllPersons(){return this.persons.toArray().then(e=>{var t;return e.map(e=>new s.Z(null!==(t=e.id)&&void 0!==t?t:null,e.name,e.title,r()(e.death_date_unixtime),e.birth_date_unixtime?r()(e.birth_date_unixtime):null,e.is_birth_date_accurate))})}constructor(){super("PersonDB"),this.version(1).stores({persons:"++id, name, title, death_date_unixtime, birth_date_unixtime, is_birth_date_accurate"})}}l.instance=new l},1926:function(e,t,a){a.d(t,{Z:function(){return c}});var n=a(8),i=a.n(n),r=a(7596),s=a.n(r),l=a(2037);class d{constructor(e,t){let a=e.asYears(),n=e.asDays(),r=(0,l.Z)(d,d,o).find(e=>e[0].asDays()-n==0);s()(a>=1||void 0!==r,"不正なduration"),this.date=i()(t.death_date),this.date.add(e);let u=()=>{if(0===n)return"";let e="\n亡くなってから";return n<=100?e+="".concat(n+1,"日目"):e+="".concat(a,"年が経過"),e};void 0!==r?(this.title=r!==(0,l.Z)(d,d,o)[0]?r[1]:null,this.summary="".concat(t.name).concat(t.title," ").concat(r[1]),this.description="".concat(this.summary),0===n?(null!==t.gyounen&&(this.summary+=" (行年 ".concat(t.gyounen,"歳)")),null!==t.birth_date&&(this.description+="\n".concat(t.birth_date.format("YYYY年M月D日 生"))),null!==t.gyounen&&(this.description+="\n行年 ".concat(t.gyounen,"歳")),null!==t.kyounen&&(this.description+="\n享年 ".concat(t.kyounen,"歳"))):this.description+=u()):(this.title=null,this.summary="".concat(t.name).concat(t.title," 命日"),this.description="".concat(this.summary).concat(u()))}}var o={writable:!0,value:[[i().duration(0),"没"],[i().duration(6,"days"),"初七日法要"],[i().duration(48,"days"),"四十九日法要"],[i().duration(99,"days"),"百ヶ日法要"],[i().duration(1,"years"),"一周忌法要"],[i().duration(2,"years"),"三回忌法要"],[i().duration(6,"years"),"七回忌法要"],[i().duration(12,"years"),"十三回忌法要"],[i().duration(16,"years"),"十七回忌法要"],[i().duration(22,"years"),"二十三回忌法要"],[i().duration(24,"years"),"二十五回忌法要"],[i().duration(26,"years"),"二十七回忌法要"],[i().duration(32,"years"),"三十三回忌法要"],[i().duration(36,"years"),"三十七回忌法要"],[i().duration(42,"years"),"四十三回忌法要"],[i().duration(46,"years"),"四十七回忌法要"],[i().duration(49,"years"),"五十回忌法要"]]};class u{constructor(e){var t,a;let n=[new d(i().duration(0),e),new d(i().duration(48,"days"),e),new d(i().duration(99,"days"),e)];for(let r=1;r<=49;r++)n.push(new d(i().duration(r,"years"),e));this.nenki_array=Object.freeze(Array.from(n)),this.next_nenki=null!==(t=n.find(e=>null!==e.title&&e.date.isSameOrAfter((0,l.Z)(u,u,h))))&&void 0!==t?t:null,this.last_nenki=null!==(a=n.reverse().find(e=>null!==e.title&&e.date.isBefore((0,l.Z)(u,u,h))))&&void 0!==a?a:null}}var h={writable:!0,value:i().tz("Asia/Tokyo")};class c{get death_date(){return this._death_date}set death_date(e){e.isSame(this._death_date)||(this._death_date=i()(e),this._nenki_list=new u(this))}get nenki_list(){return this._nenki_list}constructor(e,t,a,n,r,l){s()(null!==r||null===l,"If birth_date is null, is_birth_date_accurate must be set null."),this.db_id=e,this.name=t,this.title=a,this._death_date=n,this.gyounen=null!==r?n.diff(r,"years"):null,this.kyounen=(()=>{if(null===this.gyounen)return null;let e=this.gyounen;if(r.month()>0||r.date()>1){e+=1;let t=n.diff(r,"years"),a=i()(r).add(t,"years");n.isSameOrAfter(a)||(e+=1)}return e})(),this.birth_date=r,this.is_birth_date_accurate=null!==r?l:null,this._nenki_list=new u(this)}}}}]);