"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[366],{6366:function(e,t,i){i.r(t),i.d(t,{default:function(){return V}});var n=i(9499),a=i(7294),r=i(381),s=i.n(r),d=i(4792),o=i(3297),l=i(5084),u=i(523),h=i(1890),c=i(6779),_=i(5398),y=i(7745),f=i(2097),m=i(1225),b=i(1953),p=i(2841),v=i(1362),D=i(4642),Z=i(6540),x=i(55),g=i(8047),j=i(1733),P=i(4099),w=i(5893);function k(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function O(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?k(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):k(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function V(e){const t=e=>{const t={currentPerson:e,isNameValid:!0,isDeathDateValid:!0,isBirthDateValid:!0},i=e?{name:e.name,title:e.title,deathDate:s()(e.death_date).format("YYYY-MM-DD"),birthDate:e.birth_date?s()(e.birth_date).format("YYYY-MM-DD"):"",isBirthDateAccurate:e.is_birth_date_accurate??!1}:{name:"",title:"",deathDate:"",birthDate:"",isBirthDateAccurate:!1};return O(O({},t),i)},[{currentPerson:i,name:n,isNameValid:r,title:k,deathDate:V,isDeathDateValid:Y,birthDate:B,isBirthDateValid:$,isBirthDateAccurate:A},C]=a.useState((()=>t(null))),[T,M]=a.useState(!1),N=e=>{const{name:t,value:i}=e.target,n={isNameValid:r,isDeathDateValid:Y,isBirthDateValid:$,isBirthDateAccurate:A};"name"===t?n.isNameValid||=i.length>0:"deathDate"===t?i.length>0?n.isDeathDateValid||=!0:n.isBirthDateValid||=!0:"birthDate"===t&&(n.isBirthDateValid||=0===i.length||new Date(i)<=new Date(V)),C((e=>O(O({},e),{},{[t]:i},n)))},S=async()=>{if(r&&Y&&$){const t=s().tz(V,"YYYY-MM-DD",!0,"Asia/Tokyo"),i=""!==B?s().tz(B,"YYYY-MM-DD",!0,"Asia/Tokyo"):null,a=null!==i?A:null;if(e.editPerson)return e.editPerson.name=n,e.editPerson.title=k,e.editPerson.death_date=t,e.editPerson.birth_date=i,e.editPerson.is_birth_date_accurate=a,o.Z.instance.updatePerson(e.editPerson);{const e=new d.Z(null,n,k,t,i,a);return o.Z.instance.addPerson(e)}}return Promise.reject({isNameValid:r,isDeathDateValid:Y,isBirthDateValid:$})},E=()=>{(async()=>{const e=n.length>0,t=V.length>0,i=0===V.length||0===B.length||new Date(B)<=new Date(V);return C((n=>O(O({},n),{},{isNameValid:e,isDeathDateValid:t,isBirthDateValid:i}))),e&&t&&i?Promise.resolve():Promise.reject({isNameValid:e,isDeathDateValid:t,isBirthDateValid:i})})().then((()=>M(!0))).then(S).then(e.closeDialog).catch((e=>{})).finally((()=>M(!1)))},z=(0,f.Z)(),I=(0,m.Z)(z.breakpoints.down("sm")),F=void 0!==i,[L,G]=a.useState(!1);return i!==e.editPerson&&C((()=>t(e.editPerson))),(0,w.jsxs)(b.Z,{children:[(0,w.jsxs)(h.Z,{fullScreen:I,open:F,children:[(0,w.jsx)(y.Z,{children:"\u4eba\u7269\u306e\u8ffd\u52a0"}),(0,w.jsxs)(_.Z,{sx:{"& .MuiTextField-root":{m:2}},children:[(0,w.jsxs)(b.Z,{sx:{display:"flex"},children:[(0,w.jsx)(u.Z,{autoFocus:!0,label:"\u540d\u524d",name:"name",value:n,error:!r,helperText:r?null:"\u540d\u524d\u3092\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044",onChange:N,variant:"standard",inputProps:{size:30}}),(0,w.jsx)(u.Z,{label:"\u656c\u79f0",name:"title",value:k,onChange:N,variant:"standard",inputProps:{size:8}})]}),(0,w.jsx)(b.Z,{children:(0,w.jsx)(u.Z,{label:"\u547d\u65e5",type:"date",name:"deathDate",value:V,error:!Y,helperText:Y?null:"\u547d\u65e5\u3092\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044",onChange:N,variant:"standard",sx:{width:220},InputLabelProps:{shrink:!0}})}),(0,w.jsxs)(b.Z,{sx:{display:"flex"},children:[(0,w.jsx)(u.Z,{label:"\u751f\u5e74\u6708\u65e5",type:"date",name:"birthDate",value:B,error:!$,helperText:$?null:"\u547d\u65e5\u3088\u308a\u524d\u306e\u65e5\u4ed8\u3092\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044",onChange:N,variant:"standard",sx:{width:220},InputLabelProps:{shrink:!0}}),(0,w.jsx)(p.Z,{control:(0,w.jsx)(v.Z,{name:"isBirthDateAccurate",checked:A,onChange:e=>{const t=e.target.name,i=e.target.checked;C((e=>O(O({},e),{},{[t]:i})))},color:"primary"}),label:"\u751f\u5e74\u6708\u65e5\u306f\u6b63\u78ba\u3067\u3059"})]})]}),(0,w.jsxs)(c.Z,{children:[e.editPerson?(0,w.jsx)(P.Z,{color:"error",disabled:T,onClick:()=>{e.editPerson&&G(!0)},children:(0,w.jsx)(j.Z,{})}):null,(0,w.jsx)("div",{style:{flexGrow:1}}),(0,w.jsx)(l.Z,{variant:"outlined",color:"error",disabled:T,startIcon:(0,w.jsx)(g.Z,{}),onClick:e.closeDialog,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),e.editPerson?(0,w.jsx)(P.Z,{variant:"contained",loading:T,disabled:T,startIcon:(0,w.jsx)(x.Z,{}),onClick:E,children:"\u66f4\u65b0"}):(0,w.jsx)(P.Z,{variant:"contained",loading:T,disabled:T,startIcon:(0,w.jsx)(Z.Z,{}),onClick:E,children:"\u8ffd\u52a0"})]})]}),(0,w.jsxs)(h.Z,{open:L,children:[(0,w.jsx)(y.Z,{children:"\u78ba\u8a8d"}),(0,w.jsx)(_.Z,{children:(0,w.jsxs)(D.Z,{children:[e.editPerson?.name,e.editPerson?.title," \u306e\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3057\u307e\u3059\u304c\u3001\u3088\u308d\u3057\u3044\u3067\u3059\u304b?"]})}),(0,w.jsxs)(c.Z,{children:[(0,w.jsx)(l.Z,{onClick:()=>G(!1),children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,w.jsx)(l.Z,{color:"error",onClick:()=>{G(!1),e.editPerson&&(M(!0),o.Z.instance.deletePerson(e.editPerson).then(e.closeDialog).catch((e=>{})).finally((()=>M(!1))))},autoFocus:!0,children:"OK"})]})]})]})}},3297:function(e,t,i){i.d(t,{Z:function(){return o}});var n=i(9499),a=i(9520),r=i(8),s=i.n(r),d=i(4792);class o extends a.default{constructor(){super("PersonDB"),(0,n.Z)(this,"persons",void 0),this.version(1).stores({persons:"++id, name, title, death_date_unixtime, birth_date_unixtime, is_birth_date_accurate"})}async addPerson(e){const t={name:e.name,title:e.title,death_date_unixtime:e.death_date.valueOf(),birth_date_unixtime:e.birth_date?.valueOf()??null,is_birth_date_accurate:e.is_birth_date_accurate};return this.persons.add(t)}async updatePerson(e){return this.persons.update(e.db_id,{name:e.name,title:e.title,death_date_unixtime:e.death_date.valueOf(),birth_date_unixtime:e.birth_date?.valueOf()??null,is_birth_date_accurate:e.is_birth_date_accurate})}async deletePerson(e){return null===e.db_id?Promise.reject("Person has no db_id."):this.persons.delete(e.db_id)}async getAllPersons(){return this.persons.toArray().then((e=>e.map((e=>new d.Z(e.id??null,e.name,e.title,s()(e.death_date_unixtime),e.birth_date_unixtime?s()(e.birth_date_unixtime):null,e.is_birth_date_accurate)))))}}(0,n.Z)(o,"instance",new o)},4792:function(e,t,i){i.d(t,{Z:function(){return y}});var n=i(9499),a=i(8),r=i.n(a),s=i(7596),d=i.n(s);function o(e,t,i){return function(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}(e,t),function(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}(i,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}class l{constructor(e,t){(0,n.Z)(this,"date",void 0),(0,n.Z)(this,"title",void 0),(0,n.Z)(this,"summary",void 0),(0,n.Z)(this,"description",void 0);const i=e.asYears(),a=e.asDays(),s=o(l,l,u).find((e=>e[0].asDays()-a===0));d()(i>=1||void 0!==s,"\u4e0d\u6b63\u306aduration"),this.date=r()(t.death_date),this.date.add(e);const h=()=>{if(0===a)return"";let e="\n\u4ea1\u304f\u306a\u3063\u3066\u304b\u3089";return e+=a<=100?`${a+1}\u65e5\u76ee`:`${i}\u5e74\u304c\u7d4c\u904e`,e};void 0!==s?(this.title=s!==o(l,l,u)[0]?s[1]:null,this.summary=`${t.name}${t.title} ${s[1]}`,this.description=`${this.summary}`,0===a?(null!==t.gyounen&&(this.summary+=` (\u884c\u5e74 ${t.gyounen}\u6b73)`),null!==t.birth_date&&(this.description+=`\n${t.birth_date.format("YYYY\u5e74M\u6708D\u65e5 \u751f")}`),null!==t.gyounen&&(this.description+=`\n\u884c\u5e74 ${t.gyounen}\u6b73`),null!==t.kyounen&&(this.description+=`\n\u4eab\u5e74 ${t.kyounen}\u6b73`)):this.description+=h()):(this.title=null,this.summary=`${t.name}${t.title} \u547d\u65e5`,this.description=`${this.summary}${h()}`)}}var u={writable:!0,value:[[r().duration(0),"\u6ca1"],[r().duration(6,"days"),"\u521d\u4e03\u65e5\u6cd5\u8981"],[r().duration(48,"days"),"\u56db\u5341\u4e5d\u65e5\u6cd5\u8981"],[r().duration(99,"days"),"\u767e\u30f6\u65e5\u6cd5\u8981"],[r().duration(1,"years"),"\u4e00\u5468\u5fcc\u6cd5\u8981"],[r().duration(2,"years"),"\u4e09\u56de\u5fcc\u6cd5\u8981"],[r().duration(6,"years"),"\u4e03\u56de\u5fcc\u6cd5\u8981"],[r().duration(12,"years"),"\u5341\u4e09\u56de\u5fcc\u6cd5\u8981"],[r().duration(16,"years"),"\u5341\u4e03\u56de\u5fcc\u6cd5\u8981"],[r().duration(22,"years"),"\u4e8c\u5341\u4e09\u56de\u5fcc\u6cd5\u8981"],[r().duration(24,"years"),"\u4e8c\u5341\u4e94\u56de\u5fcc\u6cd5\u8981"],[r().duration(26,"years"),"\u4e8c\u5341\u4e03\u56de\u5fcc\u6cd5\u8981"],[r().duration(32,"years"),"\u4e09\u5341\u4e09\u56de\u5fcc\u6cd5\u8981"],[r().duration(36,"years"),"\u4e09\u5341\u4e03\u56de\u5fcc\u6cd5\u8981"],[r().duration(42,"years"),"\u56db\u5341\u4e09\u56de\u5fcc\u6cd5\u8981"],[r().duration(46,"years"),"\u56db\u5341\u4e03\u56de\u5fcc\u6cd5\u8981"],[r().duration(49,"years"),"\u4e94\u5341\u56de\u5fcc\u6cd5\u8981"]]};function h(e,t,i){return function(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}(e,t),function(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}(i,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}class c{constructor(e){(0,n.Z)(this,"nenki_array",void 0),(0,n.Z)(this,"next_nenki",void 0),(0,n.Z)(this,"last_nenki",void 0);const t=[new l(r().duration(0),e),new l(r().duration(48,"days"),e),new l(r().duration(99,"days"),e)];for(let i=1;i<=49;i++)t.push(new l(r().duration(i,"years"),e));this.nenki_array=Object.freeze(Array.from(t)),this.next_nenki=t.find((e=>null!==e.title&&e.date.isSameOrAfter(h(c,c,_))))??null,this.last_nenki=t.reverse().find((e=>null!==e.title&&e.date.isBefore(h(c,c,_))))??null}}var _={writable:!0,value:r().tz("Asia/Tokyo")};class y{constructor(e,t,i,a,s,o){(0,n.Z)(this,"db_id",void 0),(0,n.Z)(this,"name",void 0),(0,n.Z)(this,"title",void 0),(0,n.Z)(this,"gyounen",void 0),(0,n.Z)(this,"kyounen",void 0),(0,n.Z)(this,"birth_date",void 0),(0,n.Z)(this,"is_birth_date_accurate",void 0),(0,n.Z)(this,"_death_date",void 0),(0,n.Z)(this,"_nenki_list",void 0),d()(null!==s||null===o,"If birth_date is null, is_birth_date_accurate must be set null."),this.db_id=e,this.name=t,this.title=i,this._death_date=a,this.gyounen=null!==s?a.diff(s,"years"):null,this.kyounen=(()=>{if(null===this.gyounen)return null;let e=this.gyounen;if(s.month()>0||s.date()>1){e+=1;const t=a.diff(s,"years"),i=r()(s).add(t,"years");a.isSameOrAfter(i)||(e+=1)}return e})(),this.birth_date=s,this.is_birth_date_accurate=null!==s?o:null,this._nenki_list=new c(this)}get death_date(){return this._death_date}set death_date(e){e.isSame(this._death_date)||(this._death_date=r()(e),this._nenki_list=new c(this))}get nenki_list(){return this._nenki_list}}}}]);